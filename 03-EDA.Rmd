# Estadísticos descriptivos del Abandono Escolar

Empezaremos este ejercicio dividiendo nuestra encuesta, en dos set de datos uno para el entrenamiento y otro para la prueba, por ese motivo decidimos separa la base usando un muestreo estratificado debido a que las muestra no es balanceada.

Decidimos guardar **20%** como datos de prueba, siendo **2,464** y usar el restante **9,853** como datos de entrenamiento, de estos usar el **20%** de los datos de entrenamiento para hacer validación, quedando como sigue:

|Division|Total|Porcentaje|
|---|---|---|
|Prueba|2,464|20%|
|Entrenamiento|9,853|80%|
|Total|12,317|100%|

Posteriormente la muestra de entrenamiento se subdivide, para crear espacio para la muestra de validación.

|Division|Total|Porcentaje|
|---|---|---|
|Entrenamiento|7,882|80%|
|Validación |1,971|20%|
|Total |9,853|100%|
<7882/1971/9853>


```{r}
set.seed(2021)


encuesta_part_inicial <- initial_split(encuesta, strata = desertor, prop = 0.80)
encuesta_total <- training(encuesta_part_inicial)
encuesta_part_val <- validation_split(encuesta_total, prop = 0.80)
encuesta_part_val$splits


```

### Limpieza, exploración y análisis conceptual

Primero vamos a establecer que la variable desertor es la que estamos buscando, esta toma dos valores, 1 si el estudiante desertó y 0 si no lo hizo.

Podemos observar que se cuenta con 32% de desertores y 68% no desertores en la encuesta.
 

```{r}
set.seed(2021)
entrena <- training(encuesta_part_val$splits[[1]])
nrow(entrena)
entrena%>% count(desertor) %>%
  mutate(pcn = round(n / sum(n),2))
```

### Resumen general

```{r}
library(skimr)

skim(entrena)

```

### ¿El género influye?

En la siguiente tabla puede ver que parecen ser números muy similares, es decir, se observa que mientras el 33% de los hombres desertan, el 31% de las mujeres lo hacen.

Incluso pensaría que el porcentaje de mujeres que sería superior pero los datos indican lo cotrario, la tasa de deserción de mujeres es ligeramente menor que la de los hombres.

```{r}
entrena %>% select(sexo, desertor) %>% 
  group_by(sexo, desertor) %>% 
  tally() %>% mutate(pcn = round(n/sum(n),2))

```


### Entendiendo la Edad

Se puede observar un aumento de la deserción conforme aumenta la edad. Esto es comprenseible, porque conforme pasan los años, las personas tienen menos oportunidades de regresar a continuar con sus estudios.

```{r}
entrena %>% select(edad, desertor) %>% 
  group_by(edad, desertor) %>% 
  tally() %>% mutate(pcn = round(n/sum(n),2)) %>%
  ggplot(aes(factor(edad), pcn, fill = desertor)) + 
  geom_col(position = "dodge") + scale_y_continuous(labels = scales::percent_format())



datos_entrena <- entrena %>% select(edad, desertor) %>% 
  group_by(edad, desertor) %>% 
  tally() %>% mutate(pcn = round(n/sum(n),2)) 


```

##  Variables claramente importantes (hipótesis):


- Sexo 
- Promedio en la secundaria (p5)
- Tipo de secundaria a la que asistió (p6)
- Te cambiaste de escuela (p7)
- En qué tipo de institución estudiaste (p8)
- Cuanto tiempo haces a la escuela (p10)
- ¿Con quien vives? (P12_1:P12_10)
- ¿Que tanto asistes a tus clases? (p14)
- Tener hijos
- Consumo de Drogas

#### Promedio Secundaria

```{r}
tabla_univariada <- function(datos, variable, target){
  datos %>% count({{ variable }}, {{ target }}) %>% group_by({{ variable }}) %>% 
  mutate(prop = n / sum(n)) %>% mutate(pcn = round(prop, 2)) }

tabla_univariada(entrena, p5, desertor) %>%
  ggplot(aes(p5, pcn, fill = desertor)) + 
  geom_col(position = "dodge") + ggtitle("Promedio Secundaria")


entrena %>% select(sexo, desertor, p5) %>% group_by(sexo, desertor) %>%
  ggplot(aes(p5, sexo, fill = desertor)) + 
  geom_boxplot() + ggtitle("Promedio Secundaria")
```
#### Pública o Privada
Se observa que si la educación es privada la probabilidad de deserción es $18\%$, mientras que si es pública es $33\%$.

```{r}

entrena %>% select(p6, desertor) %>% filter(p6 == ' Pública' | p6 == ' Privada') %>%
  group_by(p6, desertor) %>% 
  tally() %>% mutate(pcn = round(n/sum(n),2))
```

#### Cuantos minutos haces para llegar a la escuela

La distancia **NO** parece ser un factor importante. Para que vayan o no a la escuela, independientemente del sexo.

```{r}
entrena %>% select(sexo, desertor, p10) %>% group_by(sexo, desertor) %>%
  ggplot(aes(p10, sexo, fill = desertor)) + 
  geom_boxplot() + ggtitle("Minutos que tarda en llegar a la escuela")
```

#### ¿Con quien vives? (P12_1:P12_10)

```{r}
tabla_univariada(entrena, p12_1, desertor) %>%
  ggplot(aes(p12_1, pcn, fill = desertor)) + 
  geom_col(position = "dodge") + ggtitle("¿Vives solo?")

```

```{r}

tabla_univariada(entrena, p12_8, desertor)  %>%
  ggplot(aes(p12_8, pcn, fill = desertor)) + 
  geom_col(position = "dodge") +  ggtitle("¿Vives con tus hijos?")

tabla_univariada(entrena, p12_9, desertor)  %>%
  ggplot(aes(p12_9, pcn, fill = desertor)) + 
  geom_col(position = "dodge") +  ggtitle("¿Vives con esposo(a) o pareja?")
```
##### ¿Si eres mujer y vives con tus hijo es lo mismo que si eres hombre?

```{r}
entrena %>% select(sexo, p12_9, desertor) %>% 
  filter(sexo == " Mujer") %>% group_by(p12_9, desertor) %>% tally() %>% mutate(pcn = round(n/sum(n),2)) %>%
  ggplot(aes(p12_9, pcn, fill = desertor)) + 
  geom_col(position = "dodge") +  ggtitle("Mujer: ¿Vives con tus hijos?")
```

```{r}
entrena %>% select(sexo, p12_9, desertor) %>% 
  filter(sexo == " Hombre") %>% group_by(p12_9, desertor) %>% tally() %>% mutate(pcn = round(n/sum(n),2)) %>%
  ggplot(aes(p12_9, pcn, fill = desertor)) + 
  geom_col(position = "dodge") +  ggtitle("Hombre: ¿Vives con tus hijos?")
```

#### ¿Qué tanto asistias a tus clases?

```{r}
tabla_univariada(entrena, p14, desertor) %>% 
  ggplot(aes(p14, pcn, fill = desertor)) + 
  geom_col(position = "dodge") +  ggtitle("¿Qué tanto faltabas a clase?") +
  scale_x_discrete(guide = ggplot2::guide_axis(n.dodge = 2), 
                     labels = function(x) stringr::str_wrap(x, width = 20))

```




